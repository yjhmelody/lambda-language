<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: TokenStream.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: TokenStream.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>module.exports = TokenStream

/**
 * 
 * @param {InputStream} input which has deal with byte
 * @returns {Object} which can parse token to object; used by parser
 */
function TokenStream(input) {
    //  we need a current variable which keeps track of the current token.    
    let current = null
    let keywords = ' let if then else lambda λ true false '

    return {
        next,
        peek,
        eof,
        croak: input.croak
    }

    function isKeyword(x) {
        return keywords.includes(' ' + x + ' ')
    }

    function isDigit(ch) {
        return /[0-9]/i.test(ch)
    }

    function isIdStart(ch) {
        return /[a-zλ_]/i.test(ch)
    }

    function isId(ch) {
        return isIdStart(ch) || "?!-&lt;>=0123456789".includes(ch)
    }

    function isOpChar(ch) {
        return '+-*/%=&amp;|&lt;>!'.includes(ch)
    }

    function isPunc(ch) {
        return ',;(){}[]'.includes(ch)
    }

    function isWhitespace(ch) {
        return ' \t\n'.includes(ch)
    }

    /**
     * 
     * readWhile is used to check many structs
     * @param {function} predicate 
     * @returns {String}
     */
    function readWhile(predicate) {
        let str = ''
        //when not arriving at eof &amp;&amp; next char satisfy the condition of predicate    
        // warming: debug
        // console.log('peek', input.peek())
        // console.log('pred', predicate)

        while (!input.eof() &amp;&amp; predicate(input.peek())) {
            str += input.next()
        }
        // console.log('str', str)
        return str
    }

    /*
     * 
     * We only support decimal numbers with the usual notation 
     * (no 1E5 stuff, no hex, no octal). But if we ever need more, 
     * the changes go only in read_number() and are pretty easy to do
     */
    function readNumber() {
        let hasDot = false
        let number = readWhile(function (ch) {
            // may meet two dots
            if (ch === '.') {
                if (hasDot) {
                    return false
                }
                hasDot = true
                return true
            }
            return isDigit(ch)
        })

        return {
            type: 'num',
            value: parseFloat(number)
        }
    }

    function readIdent() {
        let id = readWhile(isId)
        return {
            type: isKeyword(id) ? 'kw' : 'var',
            value: id
        }
    }

    /**
     * 
     * to escape some special symbols
     * @param {String} end 
     * @returns {String} str
     */
    function readEscaped(end) {
        let escaped = false
        let str = ''
        input.next()
        while (!input.eof()) {
            let ch = input.next()
            // attention to escaped char
            if (escaped) {
                str += ch
                escaped = false
            } else if (ch === '\\') {
                escaped = true
                // when meet end char
            } else if (ch === end) {
                break
            } else {
                str += ch
            }
        }
        return str
    }

    function readString() {
        return {
            type: 'str',
            value: readEscaped('"')
        }
    }

    function skipComment() {
        readWhile(ch => ch !== '\n')
        input.next()
    }

    /**
     * 
     * read and check the next token 
     * @returns {Object} ast
     */
    function readNext() {
        readWhile(isWhitespace)
        if (input.eof()) {
            return null
        }
        let ch = input.peek()

        if (ch === '#') {
            skipComment()
            // recursive
            return readNext()
        }
        if (ch === '"') {
            // when meet string
            return readString()
        }
        if (isDigit(ch)) {
            return readNumber()
        }
        if (isIdStart(ch)) {
            return readIdent()
        }
        if (isPunc(ch)) {
            return {
                type: 'punc',
                value: input.next()
            }
        }
        if (isOpChar(ch)) {
            // can read a multi-character operator
            return {
                type: 'op',
                value: readWhile(isOpChar)
            }
        }
        input.croak('Cannot handle character: ' + ch)
    }

    /**
     * 
     * @returns {Object} token 
     */
    function peek() {
        return current || (current = readNext())
    }

    /**
     * 
     * @returns {Object} token
     */
    function next() {
        let token = current
        current = null
        return token || readNext()
    }

    /**
     * check eof
     * @returns {Boolean}
     */
    function eof() {
        return peek() == null
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Environment.html">Environment</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyOP">applyOP</a></li><li><a href="global.html#checkDiv">checkDiv</a></li><li><a href="global.html#checkNumber">checkNumber</a></li><li><a href="global.html#checkType">checkType</a></li><li><a href="global.html#Continuation">Continuation</a></li><li><a href="global.html#evaluate">evaluate</a></li><li><a href="global.html#Execute">Execute</a></li><li><a href="global.html#GUARD">GUARD</a></li><li><a href="global.html#InputStream">InputStream</a></li><li><a href="global.html#makejs">makejs</a></li><li><a href="global.html#makeLambda">makeLambda</a></li><li><a href="global.html#parser">parser</a></li><li><a href="global.html#TokenStream">TokenStream</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Mon Sep 11 2017 21:14:55 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
