<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: codeGen.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: codeGen.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let FALSE = {
    type: "bool",
    value: false
}

/**
 * 
 * 
 * @param {any} expr expression ast 
 * @returns string with js code 
 */
function makejs(expr) {
    return js(expr)

    function js(expr) {
        switch (expr.type) {
            case 'num':
            case 'str':
            case 'bool':
                return jsAtom(expr)
            case 'var':
                return jsVar(expr)
            case 'binary':
                return jsBinary(expr)
            case 'assign':
                return jsAssign(expr)
            case 'let':
                return jsLet(expr)
            case 'lambda':
                return jsLambda(expr)
            case 'if':
                return jsIf(expr)
            case 'prog':
                return jsProg(expr)
            case 'call':
                return jsCall(expr)
            default:
                throw new SyntaxError('cannot make js for ', JSON.stringify(expr))
        }
    }

    function jsAtom(expr) {
        return JSON.stringify(expr.value)
    }

    function makeVar(name) {
        return name
    }

    function jsVar(expr) {
        return makeVar(expr.value)
    }

    function jsBinary(expr) {
        return '(' + js(expr.left) + expr.operator + js(expr.right) + ')'
    }

    function jsAssign(expr) {
        return jsBinary(expr)
    }

    function jsLambda(expr) {
        let code = '(function '
        if (expr.name) {
            code += makeVar(expr.name)
        }
        code += '(' + expr.vars.map(makeVar).join(', ') + ') {'
        code += 'return ' + js(expr.body) + '})'
        return code
    }

    function jsLet(expr) {
        if (expr.vars.length === 0) {
            return js(expr.body)
        }
        let iife = {
            type: 'call',
            func: {
                type: 'lambda',
                vars: [expr.vars[0].name],
                body: {
                    type: 'let',
                    vars: expr.vars.slice(1),
                    body: expr.body
                }
            },
            args: [expr.vars[0].def || FALSE]
        }
        return '(' + js(iife) + ')'
    }

    function jsIf(expr) {
        return '(' + js(expr.cond) + ' !== false' + '?' + js(expr.then) + ':' + js(expr.else || FALSE) + ')'
    }

    function jsProg(expr) {
        return '(' + expr.prog.map(js).join(',') + ')'
    }

    function jsCall(expr) {
        return js(expr.func) + '(' + expr.args.map(js).join(',') + ')'
    }
}

module.exports = makejs</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Environment.html">Environment</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyOP">applyOP</a></li><li><a href="global.html#checkDiv">checkDiv</a></li><li><a href="global.html#checkNumber">checkNumber</a></li><li><a href="global.html#checkType">checkType</a></li><li><a href="global.html#Continuation">Continuation</a></li><li><a href="global.html#evaluate">evaluate</a></li><li><a href="global.html#Execute">Execute</a></li><li><a href="global.html#GUARD">GUARD</a></li><li><a href="global.html#InputStream">InputStream</a></li><li><a href="global.html#makejs">makejs</a></li><li><a href="global.html#makeLambda">makeLambda</a></li><li><a href="global.html#parser">parser</a></li><li><a href="global.html#TokenStream">TokenStream</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Mon Sep 11 2017 21:14:55 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
